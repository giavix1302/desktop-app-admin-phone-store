<UserControl x:Class="AdminPhoneStore.Views.Pages.OrderView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="clr-namespace:AdminPhoneStore.Helpers"
    xmlns:models="clr-namespace:AdminPhoneStore.Models"
    mc:Ignorable="d"
    d:DesignHeight="600" d:DesignWidth="1400">
    <UserControl.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <helpers:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        
        <!-- Global Font Settings -->
        <Style TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="FontFamily" Value="Segoe UI" />
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType" />
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0"
            Background="White"
            Padding="20"
            Margin="0,0,0,16"
            CornerRadius="8">
            <Border.Effect>
                <DropShadowEffect BlurRadius="8" ShadowDepth="2" Color="#40000000" Opacity="0.1" />
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Text="Quáº£n lÃ½ ÄÆ¡n hÃ ng"
                    FontSize="24"
                    FontWeight="Bold"
                    Foreground="#1E293B"
                    VerticalAlignment="Center" />
                <Button Grid.Column="1"
                    Content="ðŸ“Š Thá»‘ng kÃª"
                    Command="{Binding LoadStatsCommand}"
                    Background="#10B981"
                    Foreground="White"
                    Padding="16,10"
                    FontSize="14"
                    FontWeight="SemiBold"
                    BorderThickness="0"
                    Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                            CornerRadius="6"
                                            Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                VerticalAlignment="Center" />
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#059669" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Border>

        <!-- Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="500" MinWidth="400" />
            </Grid.ColumnDefinitions>

            <!-- Orders List -->
            <Border Grid.Column="0"
                Background="White"
                Padding="20"
                Margin="0,0,16,0"
                CornerRadius="8">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Color="#40000000" Opacity="0.1" />
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Filters -->
                    <Border Grid.Row="0"
                        Background="#F1F5F9"
                        CornerRadius="6"
                        Padding="16"
                        Margin="0,0,0,16">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            
                            <!-- Row 1: Status, Payment Status, Payment Method -->
                            <Grid Grid.Row="0" Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="12" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="12" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Tráº¡ng thÃ¡i" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                    <ComboBox ItemsSource="{Binding OrderStatuses}"
                                        SelectedItem="{Binding SelectedStatus}"
                                        FontSize="13"
                                        Padding="12,8"
                                        Background="White"
                                        BorderBrush="#E2E8F0"
                                        BorderThickness="1" />
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Thanh toÃ¡n" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                    <ComboBox ItemsSource="{Binding PaymentStatuses}"
                                        SelectedItem="{Binding SelectedPaymentStatus}"
                                        FontSize="13"
                                        Padding="12,8"
                                        Background="White"
                                        BorderBrush="#E2E8F0"
                                        BorderThickness="1" />
                                </StackPanel>
                                
                                <StackPanel Grid.Column="4">
                                    <TextBlock Text="PhÆ°Æ¡ng thá»©c" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                    <ComboBox ItemsSource="{Binding PaymentMethods}"
                                        SelectedItem="{Binding SelectedPaymentMethod}"
                                        FontSize="13"
                                        Padding="12,8"
                                        Background="White"
                                        BorderBrush="#E2E8F0"
                                        BorderThickness="1" />
                                </StackPanel>
                            </Grid>
                            
                            <!-- Row 2: Search, Date Range, Buttons -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="12" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="12" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="12" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="MÃ£ Ä‘Æ¡n hÃ ng" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                    <TextBox Text="{Binding SearchOrderNumber, UpdateSourceTrigger=PropertyChanged}"
                                        FontSize="13"
                                        Padding="12,8"
                                        Background="White"
                                        BorderBrush="#E2E8F0"
                                        BorderThickness="1" />
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Tá»« ngÃ y" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                    <DatePicker SelectedDate="{Binding FilterFromDate}"
                                        FontSize="13"
                                        Padding="12,8"
                                        Background="White"
                                        BorderBrush="#E2E8F0"
                                        BorderThickness="1" />
                                </StackPanel>
                                
                                <StackPanel Grid.Column="4">
                                    <TextBlock Text="Äáº¿n ngÃ y" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                    <DatePicker SelectedDate="{Binding FilterToDate}"
                                        FontSize="13"
                                        Padding="12,8"
                                        Background="White"
                                        BorderBrush="#E2E8F0"
                                        BorderThickness="1" />
                                </StackPanel>
                                
                                <StackPanel Grid.Column="6" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <Button Content="Lá»c"
                                        Command="{Binding ApplyFiltersCommand}"
                                        Background="#685AFF"
                                        Foreground="White"
                                        Padding="16,8"
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        BorderThickness="0"
                                        Margin="0,0,8,0"
                                        Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="6"
                                                                Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center" />
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#5A4AE6" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button Content="XÃ³a"
                                        Command="{Binding ClearFiltersCommand}"
                                        Background="#E2E8F0"
                                        Foreground="#475569"
                                        Padding="16,8"
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="6"
                                                                Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center" />
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#CBD5E1" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>

                    <!-- DataGrid -->
                    <DataGrid x:Name="OrdersDataGrid"
                        Grid.Row="1"
                        ItemsSource="{Binding Orders}"
                        SelectedItem="{Binding SelectedOrder}"
                        AutoGenerateColumns="False"
                        HeadersVisibility="Column"
                        GridLinesVisibility="None"
                        RowHeaderWidth="0"
                        CanUserAddRows="False"
                        SelectionMode="Single"
                        IsReadOnly="True"
                        Background="Transparent"
                        BorderThickness="0"
                        Focusable="True"
                        ScrollViewer.VerticalScrollBarVisibility="Auto"
                        ScrollViewer.HorizontalScrollBarVisibility="Auto"
                        PreviewMouseWheel="OrdersDataGrid_PreviewMouseWheel"
                        MouseEnter="OrdersDataGrid_MouseEnter">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60" />
                            <DataGridTextColumn Header="MÃ£ Ä‘Æ¡n" Binding="{Binding OrderNumber}" Width="*" />
                            <DataGridTextColumn Header="Email" Binding="{Binding UserEmail}" Width="150" />
                            <DataGridTextColumn Header="Tá»•ng tiá»n" Binding="{Binding TotalAmount, StringFormat='{}{0:N0} Ä‘'}" Width="120" />
                            <DataGridTextColumn Header="Tráº¡ng thÃ¡i" Binding="{Binding Status}" Width="100" />
                            <DataGridTextColumn Header="Thanh toÃ¡n" Binding="{Binding PaymentStatus}" Width="100" />
                            <DataGridTextColumn Header="NgÃ y táº¡o" Binding="{Binding CreatedAt, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" Width="140" />
                        </DataGrid.Columns>
                        <DataGrid.Style>
                            <Style TargetType="DataGrid">
                                <Setter Property="AlternatingRowBackground" Value="#F8FAFC" />
                                <Setter Property="RowBackground" Value="White" />
                            </Style>
                        </DataGrid.Style>
                    </DataGrid>

                    <!-- Pagination -->
                    <Border Grid.Row="2"
                        Background="#F1F5F9"
                        Padding="16"
                        Margin="0,16,0,0"
                        CornerRadius="6">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0"
                                Text="{Binding TotalItems, StringFormat='Tá»•ng: {0} Ä‘Æ¡n hÃ ng'}"
                                FontSize="13"
                                Foreground="#475569"
                                VerticalAlignment="Center" />
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button Content="â—„ TrÆ°á»›c"
                                    Command="{Binding PreviousPageCommand}"
                                    Background="White"
                                    Foreground="#475569"
                                    Padding="12,6"
                                    FontSize="13"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    Margin="0,0,8,0"
                                    Cursor="Hand">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="4"
                                                            Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter HorizontalAlignment="Center"
                                                                VerticalAlignment="Center" />
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.5" />
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#E2E8F0" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <TextBlock TextAlignment="Center"
                                    VerticalAlignment="Center"
                                    Margin="0,0,8,0"
                                    MinWidth="80"
                                    FontSize="13"
                                    Foreground="#475569">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="Trang {0}/{1}">
                                            <Binding Path="CurrentPage" />
                                            <Binding Path="TotalPages" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                                <TextBlock Text="{Binding CurrentPage}"
                                    Visibility="Collapsed" />
                                <TextBlock Text="{Binding TotalPages}"
                                    Visibility="Collapsed" />
                                <Button Content="Sau â–º"
                                    Command="{Binding NextPageCommand}"
                                    Background="White"
                                    Foreground="#475569"
                                    Padding="12,6"
                                    FontSize="13"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    Cursor="Hand">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="4"
                                                            Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter HorizontalAlignment="Center"
                                                                VerticalAlignment="Center" />
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.5" />
                                                </Trigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#E2E8F0" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Border>

            <!-- Order Detail Panel -->
            <Border Grid.Column="1"
                Background="White"
                Padding="20"
                CornerRadius="8"
                Visibility="{Binding ShowOrderDetail, Converter={StaticResource BoolToVisibilityConverter}}">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Color="#40000000" Opacity="0.1" />
                </Border.Effect>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Header -->
                        <Grid Margin="0,0,0,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Chi tiáº¿t Ä‘Æ¡n hÃ ng"
                                FontSize="20"
                                FontWeight="Bold"
                                Foreground="#1E293B" />
                            <Button Grid.Column="1"
                                Content="âœ•"
                                Command="{Binding CloseOrderDetailCommand}"
                                Background="#E2E8F0"
                                Foreground="#475569"
                                Width="32"
                                Height="32"
                                FontSize="16"
                                BorderThickness="0"
                                Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="4"
                                                        Padding="0">
                                                        <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center" />
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#EF4444" />
                                                <Setter Property="Foreground" Value="White" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>

                        <!-- Order Info -->
                        <Border Background="#F1F5F9"
                            Padding="16"
                            CornerRadius="6"
                            Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="{Binding OrderDetail.OrderNumber, StringFormat='MÃ£ Ä‘Æ¡n: {0}'}"
                                    FontSize="16"
                                    FontWeight="Bold"
                                    Foreground="#1E293B"
                                    Margin="0,0,0,12" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="KhÃ¡ch hÃ ng:" FontSize="13" Foreground="#64748B" Margin="0,0,8,4" />
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding OrderDetail.UserName}" FontSize="13" Foreground="#1E293B" Margin="0,0,0,4" />
                                    
                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Email:" FontSize="13" Foreground="#64748B" Margin="0,0,8,4" />
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding OrderDetail.UserEmail}" FontSize="13" Foreground="#1E293B" Margin="0,0,0,4" />
                                    
                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Äá»‹a chá»‰:" FontSize="13" Foreground="#64748B" Margin="0,0,8,4" />
                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding OrderDetail.ShippingAddress}" FontSize="13" Foreground="#1E293B" Margin="0,0,0,4" />
                                    
                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Tá»•ng tiá»n:" FontSize="13" Foreground="#64748B" Margin="0,0,8,4" />
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding OrderDetail.TotalAmount, StringFormat='{}{0:N0} Ä‘'}" FontSize="13" FontWeight="Bold" Foreground="#1E293B" Margin="0,0,0,4" />
                                    
                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="NgÃ y táº¡o:" FontSize="13" Foreground="#64748B" Margin="0,0,8,0" />
                                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding OrderDetail.CreatedAt, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}" FontSize="13" Foreground="#1E293B" />
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- Update Status -->
                        <TextBlock Text="Cáº­p nháº­t tráº¡ng thÃ¡i" FontSize="14" FontWeight="Bold" Foreground="#1E293B" Margin="0,0,0,8" />
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ComboBox Grid.Column="0"
                                ItemsSource="{Binding OrderStatuses}"
                                SelectedItem="{Binding NewStatus}"
                                FontSize="13"
                                Padding="12,8"
                                Background="White"
                                BorderBrush="#E2E8F0"
                                BorderThickness="1" />
                            <Button Grid.Column="2"
                                Content="Cáº­p nháº­t"
                                Command="{Binding UpdateStatusCommand}"
                                Background="#685AFF"
                                Foreground="White"
                                Padding="16,8"
                                FontSize="13"
                                FontWeight="SemiBold"
                                BorderThickness="0"
                                Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center" />
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#5A4AE6" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>

                        <!-- Update Payment -->
                        <TextBlock Text="Cáº­p nháº­t thanh toÃ¡n" FontSize="14" FontWeight="Bold" Foreground="#1E293B" Margin="0,0,0,8" />
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ComboBox Grid.Column="0"
                                ItemsSource="{Binding PaymentStatuses}"
                                SelectedItem="{Binding NewPaymentStatus}"
                                FontSize="13"
                                Padding="12,8"
                                Background="White"
                                BorderBrush="#E2E8F0"
                                BorderThickness="1" />
                            <ComboBox Grid.Column="2"
                                ItemsSource="{Binding PaymentMethods}"
                                SelectedItem="{Binding NewPaymentMethod}"
                                FontSize="13"
                                Padding="12,8"
                                Background="White"
                                BorderBrush="#E2E8F0"
                                BorderThickness="1" />
                            <Button Grid.Column="4"
                                Content="Cáº­p nháº­t"
                                Command="{Binding UpdatePaymentCommand}"
                                Background="#10B981"
                                Foreground="White"
                                Padding="16,8"
                                FontSize="13"
                                FontWeight="SemiBold"
                                BorderThickness="0"
                                Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="6"
                                                        Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center" />
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#059669" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>

                        <!-- Order Items -->
                        <TextBlock Text="Sáº£n pháº©m" FontSize="14" FontWeight="Bold" Foreground="#1E293B" Margin="0,0,0,8" />
                        <DataGrid ItemsSource="{Binding OrderDetail.Items}"
                            AutoGenerateColumns="False"
                            HeadersVisibility="Column"
                            GridLinesVisibility="None"
                            RowHeaderWidth="0"
                            CanUserAddRows="False"
                            IsReadOnly="True"
                            Background="Transparent"
                            BorderThickness="0"
                            Margin="0,0,0,16">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Sáº£n pháº©m" Binding="{Binding ProductName}" Width="*" />
                                <DataGridTextColumn Header="MÃ u" Binding="{Binding ColorName}" Width="80" />
                                <DataGridTextColumn Header="SL" Binding="{Binding Quantity}" Width="50" />
                                <DataGridTextColumn Header="ÄÆ¡n giÃ¡" Binding="{Binding UnitPrice, StringFormat='{}{0:N0} Ä‘'}" Width="100" />
                                <DataGridTextColumn Header="ThÃ nh tiá»n" Binding="{Binding Subtotal, StringFormat='{}{0:N0} Ä‘'}" Width="120" />
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Tracking -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Tracking" FontSize="14" FontWeight="Bold" Foreground="#1E293B" />
                            <Button Grid.Column="1"
                                Content="+ ThÃªm"
                                Command="{Binding AddTrackingCommand}"
                                Background="#685AFF"
                                Foreground="White"
                                Padding="12,6"
                                FontSize="12"
                                FontWeight="SemiBold"
                                BorderThickness="0"
                                Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                        CornerRadius="4"
                                                        Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center" />
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#5A4AE6" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>

                        <!-- Tracking List -->
                        <ListBox ItemsSource="{Binding Trackings}"
                            SelectedItem="{Binding SelectedTracking}"
                            Margin="0,0,0,16"
                            Background="#F1F5F9"
                            BorderThickness="0"
                            MaxHeight="200"
                            ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="Padding" Value="0" />
                                    <Setter Property="Margin" Value="0,0,0,8" />
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White"
                                        Padding="12"
                                        CornerRadius="6"
                                        HorizontalAlignment="Stretch">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="{Binding Status, StringFormat='Tráº¡ng thÃ¡i: {0}'}"
                                                    FontSize="13"
                                                    FontWeight="SemiBold"
                                                    Foreground="#1E293B"
                                                    Margin="0,0,0,4" />
                                                <TextBlock Text="{Binding Description}"
                                                    FontSize="12"
                                                    Foreground="#64748B"
                                                    TextWrapping="Wrap" />
                                                <TextBlock Text="{Binding CreatedAt, StringFormat='{}{0:dd/MM/yyyy HH:mm}'}"
                                                    FontSize="11"
                                                    Foreground="#94A3B8"
                                                    Margin="0,4,0,0" />
                                            </StackPanel>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <Button Content="Sá»­a"
                                                    Command="{Binding DataContext.EditTrackingCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                    Background="#685AFF"
                                                    Foreground="White"
                                                    Padding="8,4"
                                                    FontSize="11"
                                                    BorderThickness="0"
                                                    Margin="0,0,4,0"
                                                    Cursor="Hand">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}"
                                                                            CornerRadius="4"
                                                                            Padding="{TemplateBinding Padding}">
                                                                            <ContentPresenter HorizontalAlignment="Center"
                                                                                VerticalAlignment="Center" />
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Style.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="#5A4AE6" />
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                                <Button Content="XÃ³a"
                                                    Command="{Binding DataContext.DeleteTrackingCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                    Background="#EF4444"
                                                    Foreground="White"
                                                    Padding="8,4"
                                                    FontSize="11"
                                                    BorderThickness="0"
                                                    Cursor="Hand">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}"
                                                                            CornerRadius="4"
                                                                            Padding="{TemplateBinding Padding}">
                                                                            <ContentPresenter HorizontalAlignment="Center"
                                                                                VerticalAlignment="Center" />
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Style.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="#DC2626" />
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <!-- Tracking Form -->
                        <Border Background="#F1F5F9"
                            Padding="16"
                            CornerRadius="6"
                            Visibility="{Binding ShowTrackingForm, Converter={StaticResource BoolToVisibilityConverter}}"
                            Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock FontSize="14"
                                    FontWeight="Bold"
                                    Foreground="#1E293B"
                                    Margin="0,0,0,12">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0}">
                                            <Binding Path="IsEditTracking" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="ThÃªm tracking" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsEditTracking}" Value="True">
                                                    <Setter Property="Text" Value="Sá»­a tracking" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                
                                <TextBlock Text="Tráº¡ng thÃ¡i *" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                <ComboBox ItemsSource="{Binding OrderStatuses}"
                                    SelectedItem="{Binding TrackingStatus}"
                                    FontSize="13"
                                    Padding="12,8"
                                    Background="White"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    Margin="0,0,0,12" />
                                
                                <TextBlock Text="Vá»‹ trÃ­" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                <TextBox Text="{Binding TrackingLocation}"
                                    FontSize="13"
                                    Padding="12,8"
                                    Background="White"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    Margin="0,0,0,12" />
                                
                                <TextBlock Text="MÃ´ táº£" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                <TextBox Text="{Binding TrackingDescription}"
                                    FontSize="13"
                                    Padding="12,8"
                                    Background="White"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    TextWrapping="Wrap"
                                    AcceptsReturn="True"
                                    MinHeight="60"
                                    VerticalScrollBarVisibility="Auto"
                                    Margin="0,0,0,12" />
                                
                                <TextBlock Text="Ghi chÃº" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                <TextBox Text="{Binding TrackingNote}"
                                    FontSize="13"
                                    Padding="12,8"
                                    Background="White"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    TextWrapping="Wrap"
                                    AcceptsReturn="True"
                                    MinHeight="60"
                                    VerticalScrollBarVisibility="Auto"
                                    Margin="0,0,0,12" />
                                
                                <TextBlock Text="MÃ£ váº­n Ä‘Æ¡n" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                <TextBox Text="{Binding TrackingNumber}"
                                    FontSize="13"
                                    Padding="12,8"
                                    Background="White"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    Margin="0,0,0,12" />
                                
                                <TextBlock Text="ÄÆ¡n vá»‹ váº­n chuyá»ƒn" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                <TextBox Text="{Binding ShippingPattern}"
                                    FontSize="13"
                                    Padding="12,8"
                                    Background="White"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    Margin="0,0,0,12" />
                                
                                <TextBlock Text="NgÃ y giao dá»± kiáº¿n" FontSize="12" FontWeight="SemiBold" Foreground="#475569" Margin="0,0,0,4" />
                                <DatePicker SelectedDate="{Binding EstimatedDelivery}"
                                    FontSize="13"
                                    Padding="12,8"
                                    Background="White"
                                    BorderBrush="#E2E8F0"
                                    BorderThickness="1"
                                    Margin="0,0,0,12" />
                                
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="Há»§y"
                                        Command="{Binding CancelTrackingCommand}"
                                        Background="#E2E8F0"
                                        Foreground="#475569"
                                        Padding="16,8"
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        BorderThickness="0"
                                        Margin="0,0,8,0"
                                        Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="6"
                                                                Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center" />
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#CBD5E1" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button Content="LÆ°u"
                                        Command="{Binding SaveTrackingCommand}"
                                        Background="#685AFF"
                                        Foreground="White"
                                        Padding="16,8"
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="6"
                                                                Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center" />
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#5A4AE6" />
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="2"
            Background="#80000000"
            Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Äang táº£i..."
                    FontSize="16"
                    Foreground="White"
                    Margin="0,0,0,12" />
                <ProgressBar IsIndeterminate="True"
                    Width="200"
                    Height="4"
                    Foreground="#685AFF" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
